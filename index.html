<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Cafeterías</title>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
 <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #252627;
            color: white;
        }
        
        h1 {
            color: white;
            text-align: center;
            text-transform:uppercase;
            margin: 5px;
        }
        .cafe {
            color: black;
            text-align: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
        }
        .open {
            background-color: #9edda1;
        }
        .closed {
            background-color: #fac9be;
        }
        a {
            color: black;
        }
        .debug {
            margin-top: 20px;
            padding: 10px;
            font-size: 12px;
            background: #eee;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
    p {
            font-size: 18px;
            margin: 10px 0;
        }
        </style>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="container">
        <span class="material-icons" style="display: block; text-align: center; font-size: 48px;">coffee_maker</span>
        <h1>Lista de Cafeterías</h1>
        <div id="cafeterias"></div>
        
    </div>

    <script>
        async function cargarDatos() {
            try {
                const url = "https://docs.google.com/spreadsheets/d/1N6f0Ex64tbJwiDC5Pjz2Ue6LUXJB8-lpatkvK_2nCug/gviz/tq?tqx=out:json";
                const response = await fetch(url);
                const text = await response.text();
                
                
                if (!text.startsWith("/*")) throw new Error("Formato inesperado");
                const json = JSON.parse(text.substr(47).slice(0, -2));
                
                let cafeterias = [];
                for (let i = 0; i < json.table.rows.length; i++) { // Solo tomar las dos primeras cafeterías
                    if (!json.table.rows[i]) break;
                    const nombre = json.table.rows[i].c[0]?.v || "";
                    const enlace = json.table.rows[i].c[1]?.v || "#";
                    const horario = json.table.rows[i].c[2]?.v || "";
                    
                    if (nombre) {
                        cafeterias.push({ nombre, enlace, horario });
                    }
                }
                
                
                mostrarCafeterias(cafeterias);
            } catch (error) {
                
            }
        }

        function obtenerHorarioDia(horarioTexto) {
            const diasSemana = ["domingo", "lunes", "martes", "miércoles", "jueves", "viernes", "sábado"];
            const hoy = new Date().getDay();
            const diaActual = diasSemana[hoy];
            
            const lineas = horarioTexto.split("\n");
            for (let linea of lineas) {
                if (linea.toLowerCase().startsWith(diaActual)) {
                    return linea.split(" ")[1]; // Extrae el horario (ej: "8:30–18:00")
                }
            }
            return null;
        }

        function mostrarCafeterias(cafeterias) {
            const ahora = new Date();
            const horaLocal = ahora.getHours() * 60 + ahora.getMinutes();
            
            const contenedor = document.getElementById("cafeterias");
            contenedor.innerHTML = "";
            
            cafeterias.forEach(cafe => {
                const horarioHoy = obtenerHorarioDia(cafe.horario);
                let estadoClase = "closed";
                
                if (horarioHoy) {
                    const horarioPartes = horarioHoy.match(/(\d{1,2}):(\d{2})–(\d{1,2}):(\d{2})/);
                    if (horarioPartes) {
                        const horaApertura = parseInt(horarioPartes[1]) * 60 + parseInt(horarioPartes[2]);
                        const horaCierre = parseInt(horarioPartes[3]) * 60 + parseInt(horarioPartes[4]);
                        
                        if (horaLocal >= horaApertura && horaLocal < horaCierre) {
                            estadoClase = "open";
                        }
                    }
                }
                
                const div = document.createElement("div");
                div.className = `cafe ${estadoClase}`;
                div.innerHTML = `<p style='font-weight: bold;'>${cafe.nombre}</p><p>Horario: ${horarioHoy || 'No disponible'}</p><a href='${cafe.enlace}' target='_blank' rel='noopener noreferrer'>Ver en el mapa</a>`;
                contenedor.appendChild(div);
            });
        }
        
        cargarDatos();
    </script>
</body>
</html>
